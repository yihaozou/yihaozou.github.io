<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width initial-scale=1">

<title>邹政华的随想录</title>
<meta name="description" content="Read Think Create.">
<meta name="keywords" content="zhenghua, 邹政华, meiyueyibenshu, zou zhenghua">

<link rel="icon" href="/images/favicon.ico">
<link rel="stylesheet" href="/css/main.css">
<link rel="canonical" href="http://zhenghua.info/page4/">
<link rel="alternate" type="application/atom+xml" title="邹政华的随想录" href="http://zhenghua.info/zfeed.xml" />

<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    processEscapes: true
  }
});
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for(i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});

$(document).ready(function(){
  $(".flip").click(
      function(){
        $(".panel").toggle(500);
      });
});
</script>


</head>


<body>

<div class="container">

  <header class="site-header">

  <div class="wrapper">

    <h1 class="site-title"><a href="/">邹政华的随想录</a></h1>
    <h3 class="site-meta">^o^</h3>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
        
        <a class="page-link" href="/">主页</a>
        
        
        
        <a class="page-link" href="/about/">关于我</a>
        
        
        
        <a class="page-link" href="/archives/">写作记录</a>
        
        
        
        <a class="page-link" href="/categories/">文章分类</a>
        
        
        
        <a class="page-link" href="/guestbook/">留言簿</a>
        
        
        
        
        
        
        
        <a class="page-link" href="/tags/">标签</a>
        
        
        
        <a class="page-link" href="/zfeed.xml">订阅我</a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      </div>
    </nav>

  </div>

</header>


    

  <div class="page-content col-sm-8">
    <div class="home">
  <div class="post">
    
    
  
    <header class="post-header">
      <h1 class="post-title">
        <a class="post-link" href="/%E7%BC%96%E7%A8%8B/2014/05/19/makefile_sample.html">一种makefile编写范例</a>
      </h1>
      <p class="post-meta">
      目录:
      
      <a href="/categories/#编程">编程</a>&nbsp;
      
      
      | 发表时间: May 19, 2014
      </p>
    </header>

    <article class="post-content">
      <p>makefile的编写应该考虑到代码移植的可能性，将可能发生改变的参数放在makefile文件起始部位定义成可配置的变量，从而减少修改makefile带来的工作量。</p>

<pre><code>CC = gcc
QFLAG =
MACROS = -D_OS_LINUX_
CCFLAGS= -m32
INCL = ./
C20 = $(CC)  $(QFLAG)  $(MACROS) ${CCFLAGS} -c $? -I$(INCL)
O2E =  $(CC) ${MACROS} ${CCFLAGS} -O $@ $? -ldl
</code></pre>

<p>代码中的编译器定义成CC（考虑到了UNIX用户的习惯），C2O是将源文件编译成目标文件，O2E是将目标文件连接成可执行文件或库文件。使用这些定义成变量的编译参数来编译源代码，可以减少编写makefile文件时敲击键盘的次数，同时提高makefile文件的可读性和移植性。下面给出一个实际项目的编译例子。</p>

<pre><code>all: ppmmonitor
ppmmonitor: ppm_monitor.o snapshot.o ppm_loex.o
            $(O2E) -lncurses
ppm_monitor.o: ppm_socket.c ppm_log_ex.c snapshot.c ppm_monitor.c 
            $(C2O)
#此处省略snapshot.o和ppm_log_ex.o的编译
</code></pre>

<p>可以看出编写出的makefile文件非常的简洁。如果要移植到AIX系统，只需要将CC定义成cc，QFLAG定义成qcpluscmt,同时注释掉MACROS即可。另外，如果代码文件较多，并且需要在不同系统间迁移，也可以使用gnu的autotools工具来打包源代码，生成安装脚本。</p>

    </article> <hr />
    
    
  
    <header class="post-header">
      <h1 class="post-title">
        <a class="post-link" href="/%E7%BC%96%E7%A8%8B/2014/05/11/data_types_in_c.html">信息表示与处理</a>
      </h1>
      <p class="post-meta">
      目录:
      
      <a href="/categories/#编程">编程</a>&nbsp;
      
      
      | 发表时间: May 11, 2014
      </p>
    </header>

    <article class="post-content">
      <p><strong>C语言中数据类型的字节数</strong></p>

<table cellpadding="0" width="398" cellspacing="0" border="0"> 
<tbody>
<tr>
<td width="120" height="18">C声明</td>
<td width="139">32位机器（字节）</td>
<td width="139">64位机器（字节）</td>
</tr>



<tr>
<td height="18">char</td>
<td>1</td>
<td>1</td>
</tr>


<tr>
<td height="18">short int</td>
<td>2</td>
<td>2</td>
</tr>


<tr>
<td height="18">int</td>
<td>4</td>
<td>4</td>
</tr>


<tr>
<td height="18">long int</td>
<td>4</td>
<td>8</td>
</tr>

<tr>
<td height="18">long long int</td>
<td>8</td>
<td>8</td>
</tr>


<tr>
<td height="18">char *</td>
<td>4</td>
<td>8</td>
</tr>

<tr>
<td height="18">float</td>
<td>4</td>
<td>4</td>
</tr>


<tr>
<td height="18">double</td>
<td>8</td>
<td>8</td>
</tr>

</tbody>
</table>

<p><strong>整型和无符号整形的比较</strong></p>

<table cellpadding="0" width="479" cellspacing="0" border="0"> 
<tbody>
<tr>

<td width="224" height="18">表达式（后缀U表示无符号整型）
</td>

<td width="122">比较类型
</td>

<td width="133">结果
</td>
</tr>
<tr>

<td height="18">0==0U
</td>

<td>无符号
</td>

<td>1
</td>
</tr>
<tr>

<td height="18">-1&lt;0
</td>

<td>有符号
</td>

<td>1
</td>
</tr>
<tr>

<td height="18">-1&lt;0U
</td>

<td>无符号
</td>

<td>0
</td>
</tr>
<tr>

<td height="18">2147483647&gt;-2147483647-1
</td>

<td>有符号
</td>

<td>1
</td>
</tr>
<tr>

<td height="18">2147483647U&gt;-2147483647-1
</td>

<td>无符号
</td>

<td>0
</td>
</tr>
<tr>

<td height="18">2147483647&gt;(int)2147483647U
</td>

<td>有符号
</td>

<td>1
</td>
</tr>
<tr>

<td height="18">-1&gt;-2
</td>

<td>有符号
</td>

<td>1
</td>
</tr>
<tr>

<td height="18">(unsigned)-1&gt;-2
</td>

<td>无符号
</td>

<td>1
</td>
</tr>
</tbody>
</table>
<p><strong>整型和无符号整型隐式转换带来的安全风险</strong></p>

<table cellpadding="0" width="598" cellspacing="0" border="0"> 
<tbody>
<tr>

<td width="416" height="18">函数定义
</td>

<td width="182">安全风险
</td>
</tr>
<tr>

<td width="416" height="72">int strlonger(char *s, char *t){
return strlen(s)-strlen(t)&gt;0
}
</td>

<td width="182">strlen返回值size_t是定义成unsigned int。如果s的长度小于t，仍然会返回1
</td>
</tr>
<tr>

<td width="416" height="126">#define KSIZE 1024
char kbuf[KSIZE];
int copy_from_kernel(void *user_dest, int maxlen){
int len=ksize &lt;maxlen?ksize:maxlen;
memcpy(user_dest, kbuf, len);
return len;
}
</td>

<td width="182">memcpy的参数为size_t,定义为unsigned int。函数原型中定义的maxlen为整型。若程序员恶意传入负数，会引发非法地址错误
</td>
</tr>
</tbody>
</table>

    </article> <hr />
    
    
  
    <header class="post-header">
      <h1 class="post-title">
        <a class="post-link" href="/%E8%AF%BB%E4%B9%A6/2014/05/04/fu_bing_zhi_du_1.html">府兵制（上）</a>
      </h1>
      <p class="post-meta">
      目录:
      
      <a href="/categories/#读书">读书</a>&nbsp;
      
      
      | 标签:
      
      <a href="/tags/#history" title="history">history </a>
      
      
      | 发表时间: May 4, 2014
      </p>
    </header>

    <article class="post-content">
      <p>“宇文泰相魏，辅以苏绰经济之略，于军尤详。六军百府，始仿周典而稍还兵农不分之旧
    。泰始藉民之才力者为府兵，身租庸调一切蠲之，以农隙讲阅战阵，马畜粮备，六家供
    之，合为百府。每府一郎将主之，分属二十四军。泰督中外诸军，六人各督二大将军，
    凡十二大将军。每大将军各统开府二人，开府各领一军。盖至是而广州、山南、北山皆
    劲兵矣。”。 –《历代兵制》</p>

<p>北魏孝文帝宏迁都洛阳后，南迁的鲜卑贵族加速汉化，驻留北方边境的鲜卑贵族及其部曲地位急速下降。汉化的不同步激发了矛盾并引发“六镇之乱”，在镇压叛乱的过程中，军权落入尔朱氏手中。后来高欢诛尔朱氏并主导成立了东魏，宇文泰得到关陇集团的支持主导成立了西魏。至此，北魏分裂，东魏和西魏的两位皇帝分别为高欢和宇文泰的傀儡。</p>

<p>宇文泰是在贺拔岳死后被推举为关陇集团的首领的，并没有自己的嫡系部队。因为处在乱世，门阀都拥有自己的私人武装。为了稳固自己的统治，宇文泰需要设计出一套军事架构用来笼络各个门阀以及地方豪强的势力，于是便有了六柱国统领系统（实际为八柱国，西魏皇族占据两个名额，却没有领兵），取周制“天子六军”之意。六柱国统领系统有一个递归过程，先是六个柱国大将军统领六军，六军分左右，成为十二军，由十二大将军所领。十二军再分左右军成为二十四军，为各骠骑大将军、开府仪同三司所领。柱国大将军、大将军这两级统帅虽然存在，但皇朝政令通常直接地以二十四军为基本的宣达和执行单位。通过这一系统，地方豪强的私人武装逐渐中央化了。</p>

<p>除了整顿地方乡兵外，宇文泰还采取”籍民为兵“的方式来扩充军队，这里的”籍“有户口的意思，即将”民籍“转为”军籍“，成为府兵。府兵平时还是种地，但是农隙之余，需要参加军事训练，需要宿卫（都城）或者戍边。作为交换，府兵可以拥有政府分配的土地，不用交租，不用服劳役，不用上供土特产（也就是免除了租庸调）。</p>

<p>府兵的选择标准有三个，户等(家世）、丁口（成年男人数量）、材力（身体素质）。其中“户等”按照家产分成九等（类同于九品中正制），中上六等为选拔门槛。满足家世标准后，家有三丁者选身体素质优秀者一人充当府兵，或者五丁选二。从这里可以看出，宇文泰是想要地方豪强或富户充当军队的核心的，理由是将强力者纳入体制内有利于维护系统稳定，另外一方面，富裕家庭出来的孩子身体素质往往会好一些，从而提升军队素质。</p>

<p>这样以后，府兵制的雏形便出来了。中央政府划定区域设立“府”，在该区域内按照给定标准和数量挑选”兵户“，”兵户“免除租庸调，但是得为中央政府提供兵员。府兵平时种地，农隙训练，战时出征。自己负责装备，没有津贴，出征时由中央政府指定将军统领，战后还是回来种地。这样一来，中央政府养兵的费用大大减少，又能防止地方割据势力的产生，府兵的装备维护保养工作也较为出色（关系自家性命），这些因素综合在一起使得府兵制格外受到统治者的青睐，历经西魏、北周、隋、唐朝而不衰。</p>

<p>还有一个问题是为什么富户愿意充当府兵，这跟当时的均田制有密切关系，均田制规定“计口分田”，也就是按人口数均分田地，但是奴婢和耕牛也包括在内（有照顾地主的意思），那么富户能够分得田地和相应的租庸调都会不少，充当府兵有着现实的利益。另外，北朝尚武，“丈夫生世，会须履锋刃，平寇难，安社稷，以取功名”也是很重要的因素。</p>

<p>宇文泰过世后，宇文护和宇文邕延续了这一政策，使的府兵制得以继续完善。南北朝期间英雄人物辈出，宇文泰、高欢、宇文邕等人文治武功冠绝一时，但是知名度不高，是一件很奇怪的事情。</p>

    </article> <hr />
    
    
  
    <header class="post-header">
      <h1 class="post-title">
        <a class="post-link" href="/%E7%BC%96%E7%A8%8B/2014/04/22/undefined_symbol_in_so.html">动态链接库中的未定义符号</a>
      </h1>
      <p class="post-meta">
      目录:
      
      <a href="/categories/#编程">编程</a>&nbsp;
      
      
      | 发表时间: Apr 22, 2014
      </p>
    </header>

    <article class="post-content">
      <p>由于一时疏忽，将c语言源码中的标准库函数strcmp写成了strcpm，然后使用xlc编译器编译成动态链接库so文件。在这个过程中没有报错。后来使用dlopen打开动态链接库so文件时，出现dlerr错误，具体为“Symbol strcpm was referenced from module apcomp.so, but a runtime definition was not found”。将源代码中的strcpm改成strcmp后重新编译，动态链接库文件正常工作。</p>

<p>究其原因，是编译器在编译动态链接库时，并不检查符号的依赖项，也就是说如果如果引用了某符号却没有链接其对应的库，编译器仍然会编译通过。</p>

<p>但是在加载动态链接库时会因为出现未定义符号而失败。编译器在生成可执行文件时，会严格检查符号是否都有定义。（还有一个与主题无关的问题，如果链接了一个未使用的库，其中的符号也会全部链接过来）</p>

    </article> <hr />
    
    
  
    <header class="post-header">
      <h1 class="post-title">
        <a class="post-link" href="/%E7%BC%96%E7%A8%8B/2014/04/12/message_module.html">短信模块概要设计（简化）</a>
      </h1>
      <p class="post-meta">
      目录:
      
      <a href="/categories/#编程">编程</a>&nbsp;
      
      
      | 发表时间: Apr 12, 2014
      </p>
    </header>

    <article class="post-content">
      <p>（短信模块的功能：向公司各产品提供接口，各产品通过短信模块向客户发送短信）</p>

<p><strong>数据库设计：</strong></p>
<table>
<tbody>
<tr>

<td width="151" valign="top">表中文名称
</td>

<td width="180" valign="top">表英文名称
</td>

<td width="236" valign="top">描述
</td>
</tr>
<tr>

<td width="151" valign="top">短信配置参数表
</td>

<td width="180" valign="top">XXXXX
</td>

<td width="236" valign="top"> 包含各项配置参数，如服务器ip、端口，调用的脚本，用户名，密码（加密后），短信重发次数等
</td>
</tr>
<tr>

<td width="151" valign="top">短信入参表
</td>

<td width="180" valign="top">XXXXX
</td>

<td width="236" valign="top"> 包含短信内容，手机号，发送时间日期，发送机器的ip等信息
</td>
</tr>
<tr>

<td width="151" valign="top">短信发布明细表
</td>

<td width="180" valign="top">XXXXX
</td>

<td width="236" valign="top"> 记录短信发送结果等信息
</td>
</tr>
</tbody>
</table>
<p><strong>流程设计：</strong></p>

<p><img src="/images/2014/2014-04-12-short_message_flow.jpg" alt="短信流程图" /></p>

<p><strong>外部接口设计</strong></p>

<p>短信模块对外提供报文和文件两种接口。使用报文方式（流程图中的TCP/IP)发送单条短信，只需要使用短信入参组件向短信入参表插入短信内容即可。使用文件方式（流程图中的FTP）发送短信内容时，需要在短信入参表中指定文件发送脚本（由system函数调用），短信文件格式参照给定的例子，单个文件可包含5000条短信机收件人信息。</p>

    </article> <hr />
    
    
  
  </div>
</div>

    <section class="pager">
  
  
  <li class="previous"><a href="/page3/" title="后一页">&larr; 后一页</a></li>
  
  
  
  <li class="next"><a href="/page5/" title="前一页">前一页 &rarr;</a></li>
  
</section>


  </div>
  <div class="col-sm-2">
<div class="sidebar-module about">
  <h4>关于我</h4>
  <img title="Lijia YU" src="https://i.imgur.com/Mdc4szJl.jpg" alt="Lijia YU"/>
  <span>Hi,我是邹政华，欢迎访问我的博客。</span>
  <br />

  

  微信号:692266086 


  

</div>

<div class="sidebar-module">
  <h4>近期文章</h4>
  
  <li>
  <a href="//%E8%AF%BB%E4%B9%A6/2015/04/15/Designing_design.html" title="DESIGNING DESIGN" rel="bookmark">DESIGNING DESIGN</a>
  </li>
  
  <li>
  <a href="//%E8%AF%BB%E4%B9%A6/2015/02/16/yi_shui_bei_ge.html" title="易水悲歌" rel="bookmark">易水悲歌</a>
  </li>
  
  <li>
  <a href="//%E8%AF%BB%E4%B9%A6/2015/01/02/editor_notes_for_meiyueyibenshu_2014.html" title="编者按合辑(一)" rel="bookmark">编者按合辑(一)</a>
  </li>
  
  <li>
  <a href="//%E7%BC%96%E7%A8%8B/2014/12/27/move_blog_to_jekyll.html" title="使用jekyll和markdown写作博客" rel="bookmark">使用jekyll和markdown写作博客</a>
  </li>
  
  <li>
  <a href="//%E8%AF%BB%E4%B9%A6/2014/11/09/shi_liu_guo_bei_chao.html" title="十六国北朝－无序的车辙" rel="bookmark">十六国北朝－无序的车辙</a>
  </li>
  
</div>


<div class="sidebar-module">
  <h4>分类目录</h4>
  
  <li><a href="/categories/#总结与遐想" title="总结与遐想" rel="13">总结与遐想 (13)</a></li>
  
  <li><a href="/categories/#行业观察" title="行业观察" rel="1">行业观察 (1)</a></li>
  
  <li><a href="/categories/#编程" title="编程" rel="15">编程 (15)</a></li>
  
  <li><a href="/categories/#读书" title="读书" rel="16">读书 (16)</a></li>
  
</div>


<div class="sidebar-module">
  <h4>存档</h4>

  
  
  
  
  
  <li id="2015" > <a href="/archives/#2015">2015</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2014" > <a href="/archives/#2014">2014</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2013" > <a href="/archives/#2013">2013</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2012" > <a href="/archives/#2012">2012</a></li>
  
  
  
  
  
  
  
  
  
  
  <li id="2010" > <a href="/archives/#2010">2010</a></li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <li id="2009" > <a href="/archives/#2009">2009</a></li>
  
  

</div>


</div>



  

  <footer class="site-footer">

  <p>Copyright &copy; <a href="/">邹政华的随想录</a></p>
  <p>Powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a> 
  on 
  
  <a href="https://github.com/">Github</a>
  
  | Theme <a href="https://github.com/yulijia/freshman21/">Freshman21</a> Design by <a href="http://yulijia.net">Lijia Yu</a>  

</footer>


</div>

</body>

</html>
